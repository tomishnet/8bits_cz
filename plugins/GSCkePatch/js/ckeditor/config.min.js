CKEDITOR.editorConfig=function(config){config.resize_dir="vertical";config.toolbarCanCollapse=false;config.dialog_backgroundCoverColor="#000000";config.magicline_color="#CF3805";config.allowedContent=true;config.toolbar_advanced=[["Bold","Italic","Underline","NumberedList","BulletedList","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","Table","TextColor","BGColor","Link","Unlink","Image","RemoveFormat","Source"],"/",["Styles","Format","Font","FontSize"],["About"]];config.toolbar_basic=[["Bold","Italic","Underline","NumberedList","BulletedList","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","Link","Unlink","Image","RemoveFormat","Source"],["About"]]};CKEDITOR.on("instanceReady",function(ev){var blockTags=["div","h1","h2","h3","h4","h5","h6","p","pre","li","blockquote","ul","ol","table","thead","tbody","tfoot","td","th"];var rules={indent:true,breakBeforeOpen:true,breakAfterOpen:false,breakBeforeClose:false,breakAfterClose:true};for(var i=0;i<blockTags.length;i++){ev.editor.dataProcessor.writer.setRules(blockTags[i],rules)}});CKEDITOR.on("dialogDefinition",function(ev){var dialogName=ev.data.name;var dialogDefinition=ev.data.definition;ev.data.definition.resizable=CKEDITOR.DIALOG_RESIZE_NONE;if(dialogName=="link"){var infoTab=dialogDefinition.getContents("info");var advTab=dialogDefinition.getContents("advanced");advTab.remove("advLangDir");advTab.remove("advLangCode");advTab.remove("advContentType");advTab.remove("advTitle");advTab.remove("advCharset")}if(dialogName=="image"){var infoTab=dialogDefinition.getContents("info");infoTab.remove("txtBorder");infoTab.remove("txtHSpace");infoTab.remove("txtVSpace");infoTab.remove("btnResetSize");dialogDefinition.removeContents("Link");var advTab=dialogDefinition.getContents("advanced");advTab.remove("cmbLangDir");advTab.remove("txtLangCode");advTab.remove("txtGenLongDescr");advTab.remove("txtGenTitle")}});var menuItems;$.getJSON("inc/ajax.php?list_pages_json=1",function(data){menuItems=data;if(typeof editor!=="undefined")CKEsetupLinks(editor)});CKEsetupLinks=function(editorObj){if(typeof editorObj==="undefined")return;CKEDITOR.on("dialogDefinition",function(ev){if(ev.editor!=editorObj||ev.data.name!="link"||!menuItems)return;var definition=ev.data.definition;definition.onFocus=CKEDITOR.tools.override(definition.onFocus,function(original){return function(){original.call(this);if(this.getValueOf("info","linkType")=="localPage"){}}});var infoTab=definition.getContents("info");var content=CKEgetById(infoTab.elements,"linkType");content.items.unshift(["Link to local page","localPage"]);content["default"]="localPage";infoTab.elements.push({type:"vbox",id:"localPageOptions",children:[{type:"select",id:"localPage_path",label:"Select page:",required:true,items:menuItems,setup:function(data){if(data.localPage)this.setValue(data.localPage)}}]});content.onChange=CKEDITOR.tools.override(content.onChange,function(original){return function(){original.call(this);var dialog=this.getDialog();var element=dialog.getContentElement("info","localPageOptions").getElement().getParent().getParent();if(this.getValue()=="localPage"){element.show();if(editorObj.config.linkShowTargetTab){dialog.showPage("target")}var uploadTab=dialog.definition.getContents("upload");if(uploadTab&&!uploadTab.hidden){dialog.hidePage("upload")}}else{element.hide()}}});content.setup=function(data){if(!data.type||data.type=="url"&&!data.url){data.type="localPage";if(typeof linkdefault!=="undefined")data.type=linkdefault}else if(data.url&&!data.url.protocol&&data.url.url){if(path){data.type="localPage";data.localPage_path=path;delete data.url}}this.setValue(data.type)};content.commit=function(data){data.type=this.getValue();if(data.type=="localPage"){data.type="url";var dialog=this.getDialog();dialog.setValueOf("info","protocol","");dialog.setValueOf("info","url",dialog.getValueOf("info","localPage_path"))}}},null,null,1)};CKEgetById=function(array,id,recurse){for(var i=0,item;item=array[i];i++){if(item.id==id)return item;if(recurse&&item[recurse]){var retval=CKEgetById(item[recurse],id,recurse);if(retval)return retval}}return null};var getById=CKEgetById;CKEDITOR.on("instanceReady",function(event){event.editor.on("dialogShow",function(dialogShowEvent){if(CKEDITOR.env.ie){$(dialogShowEvent.data._.element.$).find('a[href*="void(0)"]').removeAttr("href")}})});